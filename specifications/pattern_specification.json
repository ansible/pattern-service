{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "title": "Ansible Pattern Schema",
    "description": "A schema for defining and validating Ansible patterns",
    "type": "object",
    "required": [
        "schema_version",
        "name",
        "title",
        "description",
        "short_description",
        "tags",
        "aap_resources"
    ],
    "properties": {
        "schema_version": {
            "description": "Version of the schema format being used",
            "type": "string"
        },
        "name": {
            "description": "Machine readable name for the pattern. MUST match the directory name",
            "pattern": "^[a-z0-9_]+$",
            "type": "string"
        },
        "title": {
            "description": "Human readable title for the pattern, may be used for pattern catalog and display purposes. It MUST be under TBD characters and MUST start with an action verb (e.g. Create an instance)",
            "type": "string"
        },
        "description": {
            "description": "A detailed explanation of what the pattern does. Use complete sentences to describe its functionality. This must provide more information than the short description and must be under TBD characters",
            "type": "string"
        },
        "short_description": {
            "description": "A brief summary of what the pattern does that can be used for display purposes",
            "type": "string"
        },
        "tags": {
            "description": "List of tags associated with the pattern",
            "type": "array",
            "items": {
                "type": "string"
            },
            "minItems": 1,
            "uniqueItems": true
        },
        "aap_resources": {
            "description": "Define the resources required in AAP to run the pattern automation",
            "type": "object",
            "required": [
                "controller_project",
                "controller_execution_environment",
                "controller_job_templates"
            ],
            "properties": {
                "controller_project": {
                    "description": "Information about the project to be created in automation controller. Every pattern MUST specify a controller project, which will be sourced from the pattern's parent collection published in private automation hub",
                    "type": "object",
                    "required": [
                        "name",
                        "description"
                    ],
                    "properties": {
                        "name": {
                            "description": "Name for the project to be created in automation controller",
                            "type": "string"
                        },
                        "description": {
                            "description": "Description for the project to be created in automation controller",
                            "type": "string"
                        }
                    }
                },
                "controller_execution_environment": {
                    "description": "Definition of the execution environment (EE) to be used by the pattern. An EE should be included if the pattern requires dependencies that are not available in the default controller EE. The EE image MUST be published in Private Automation Hub",
                    "type": "object",
                    "required": [
                        "name",
                        "description",
                        "image_name"
                    ],
                    "properties": {
                        "name": {
                            "description": "Name for the EE to be created in automation controller",
                            "type": "string"
                        },
                        "description": {
                            "description": "Description for the EE to be created in automation controller",
                            "type": "string"
                        },
                        "image_name": {
                            "description": "Full location for the EE image, including the container registry, image name, and version tag",
                            "type": "string"
                        },
                        "pull": {
                            "description": "Whether to pull the EE image before running",
                            "type": "string",
                            "enum": [
                                "always",
                                "missing",
                                "never"
                            ]
                        }
                    }
                },
                "controller_labels": {
                    "description": "Labels to create for the pattern if not already present in automation controller",
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "minItems": 1,
                    "uniqueItems": true
                },
                "controller_job_templates": {
                    "description": "A list of one or more job templates to be created in automation controller",
                    "type": "array",
                    "minItems": 1,
                    "items": {
                        "type": "object",
                        "required": [
                            "name",
                            "description",
                            "playbook"
                        ],
                        "properties": {
                            "name": {
                                "description": "Name for the job template to be created in automation controller",
                                "type": "string"
                            },
                            "description": {
                                "description": "Description for the job template to be created in automation controller",
                                "type": "string"
                            },
                            "execution_environment": {
                                "description": "Name of the execution environment to use for job template execution. MUST match the EE name defined in controller_execution_environment, IF defined",
                                "type": "string"
                            },
                            "playbook": {
                                "description": "Name of the playbook file included in the pattern `automations` directory",
                                "type": "string"
                            },
                            "ask_credential_on_launch": {
                                "description": "Whether the user must select a credential when launching the job template",
                                "type": "boolean"
                            },
                            "ask_inventory_on_launch": {
                                "description": "Whether the user must select an inventory when launching the job template",
                                "type": "boolean"
                            },
                            "ask_verbosity_on_launch": {
                                "description": "Whether the user must choose a verbosity level when launching the job template",
                                "type": "boolean"
                            },
                            "labels": {
                                "description": "List of labels to apply to the job template",
                                "type": "array",
                                "items": {
                                    "type": "string"
                                },
                                "minItems": 1,
                                "uniqueItems": true
                            },
                            "survey": {
                                "description": "A survey that captures required and optional variables from the user for configuring job templates",
                                "type": "object",
                                "required": [
                                    "name",
                                    "description",
                                    "spec"
                                ],
                                "properties": {
                                    "name": {
                                        "type": "string",
                                        "description": "Name of the survey"
                                    },
                                    "description": {
                                        "type": "string",
                                        "description": "Description of the survey"
                                    },
                                    "spec": {
                                        "type": "array",
                                        "description": "List of survey questions",
                                        "items": {
                                            "type": "object",
                                            "required": [
                                                "type",
                                                "question_name",
                                                "question_description",
                                                "variable",
                                                "required"
                                            ],
                                            "properties": {
                                                "type": {
                                                    "type": "string",
                                                    "description": "Type of input field",
                                                    "enum": [
                                                        "text",
                                                        "password",
                                                        "integer",
                                                        "float",
                                                        "multiplechoice",
                                                        "multiselect"
                                                    ]
                                                },
                                                "question_name": {
                                                    "type": "string",
                                                    "description": "Human-readable question title"
                                                },
                                                "question_description": {
                                                    "type": "string",
                                                    "description": "Description or help text for the question"
                                                },
                                                "variable": {
                                                    "type": "string",
                                                    "description": "Variable name used to store the answer"
                                                },
                                                "required": {
                                                    "type": "boolean",
                                                    "description": "Whether this question must be answered"
                                                },
                                                "choices": {
                                                    "type": "array",
                                                    "description": "List of selectable values for multiple choice questions",
                                                    "items": {
                                                        "type": "string"
                                                    }
                                                },
                                                "default": {
                                                    "type": "string",
                                                    "description": "Default value for the input field"
                                                }
                                            },
                                            "allOf": [
                                                {
                                                    "if": {
                                                        "properties": {
                                                            "type": {
                                                                "const": "multiplechoice"
                                                            }
                                                        }
                                                    },
                                                    "then": {
                                                        "required": [
                                                            "choices"
                                                        ]
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}